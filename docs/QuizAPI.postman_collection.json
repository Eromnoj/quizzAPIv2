{
  "info": {
    "name": "Quiz API v2",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000"
    }
  ],
  "item": [
    {
      "name": "Utils",
      "item": [
        {
          "name": "Get CSRF Token",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/v2/csrf"
          }
        },
        {
          "name": "Who am I (requires session)",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/v2/user"
          }
        },
        {
          "name": "Health test",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/v2/test"
          }
        }
      ]
    },
    {
      "name": "Auth",
      "item": [
        {
          "name": "Register",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Alice\",\n  \"email\": \"alice@example.com\",\n  \"password\": \"Sup3rStr0ng!\",\n  \"passwordConfirm\": \"Sup3rStr0ng!\"\n}"
            },
            "url": "{{baseUrl}}/api/v2/auth/register"
          }
        },
        {
          "name": "Login (session cookie)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"alice@example.com\",\n  \"password\": \"Sup3rStr0ng!\"\n}"
            },
            "url": "{{baseUrl}}/api/v2/auth/login"
          }
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "url": "{{baseUrl}}/api/v2/auth/logout"
          }
        }
      ]
    },
    {
      "name": "Recovery",
      "item": [
        {
          "name": "Send recovery mail",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"alice@example.com\"\n}"
            },
            "url": "{{baseUrl}}/api/v2/recovery/send-mail"
          }
        },
        {
          "name": "Recover password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"<token>\",\n  \"email\": \"alice@example.com\",\n  \"newPassword\": \"Sup3rStr0ng!\"\n}"
            },
            "url": "{{baseUrl}}/api/v2/recovery/recover-password"
          }
        }
      ]
    },
    {
      "name": "Quiz - Public",
      "item": [
        {
          "name": "Get quizzes (filtered)",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v2/quiz?difficulty=facile&category=histoire&limit=10"
          }
        },
        {
          "name": "Get quiz by id",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v2/quiz/{{quizId}}"
          }
        },
        {
          "name": "Get categories",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v2/quiz/categories"
          }
        },
        {
          "name": "Get category by id",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v2/quiz/categories/{{categoryId}}"
          }
        },
        {
          "name": "Count quizzes",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v2/quiz/count"
          }
        },
        {
          "name": "Report quiz",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"Réponse incorrecte\"\n}"
            },
            "url": "{{baseUrl}}/api/v2/quiz/{{quizId}}/report",
            "description": "Ajoute un signalement. À partir de 5 signalements, le quiz repasse en validation (pending=true)."
          }
        }
      ]
    },
    {
      "name": "Quiz - Submit/Moderate",
      "item": [
        {
          "name": "Create quiz (non-admin pending)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"question\": \"Capitale de la France ?\",\n  \"answer\": \"Paris\",\n  \"badAnswer1\": \"Lyon\",\n  \"badAnswer2\": \"Marseille\",\n  \"badAnswer3\": \"Bordeaux\",\n  \"categoryId\": \"<categoryId>\",\n  \"difficulty\": \"facile\"\n}"
            },
            "url": "{{baseUrl}}/api/v2/quiz"
          }
        },
        {
          "name": "List pending (admin)",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/v2/quiz/pending"
          }
        },
        {
          "name": "Validate/Unvalidate pending (admin)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": false\n}"
            },
            "url": "{{baseUrl}}/api/v2/quiz/pending/{{quizId}}"
          }
        },
        {
          "name": "Admin list paginated",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v2/quiz/getAll?page=1&limit=10"
          }
        },
        {
          "name": "Update quiz (admin)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"question\": \"Capitale ?\",\n  \"answer\": \"Paris\",\n  \"badAnswer1\": \"Lyon\",\n  \"badAnswer2\": \"Marseille\",\n  \"badAnswer3\": \"Bordeaux\",\n  \"categoryId\": \"<categoryId>\",\n  \"difficulty\": \"facile\"\n}"
            },
            "url": "{{baseUrl}}/api/v2/quiz/{{quizId}}"
          }
        },
        {
          "name": "Delete quiz (admin)",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "url": "{{baseUrl}}/api/v2/quiz/{{quizId}}"
          }
        },
        {
          "name": "Get reported quizzes",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/v2/quiz/reported",
            "description": "Liste des quiz ayant au moins un signalement (admin)."
          }
        },
        {
          "name": "Delete report",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "url": "{{baseUrl}}/api/v2/quiz/reports/{{reportId}}",
            "description": "Supprime un signalement précis (admin)."
          }
        },
        {
          "name": "Clear quiz reports",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "url": "{{baseUrl}}/api/v2/quiz/{{quizId}}/reports",
            "description": "Supprime tous les signalements pour un quiz donné (admin)."
          }
        }
      ]
    },
    {
      "name": "Admin - Users",
      "item": [
        {
          "name": "List users",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v2/admin/users"
          }
        },
        {
          "name": "Create user",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Bob\",\n  \"email\": \"bob@example.com\",\n  \"password\": \"Sup3rStr0ng!\",\n  \"passwordConfirm\": \"Sup3rStr0ng!\"\n}"
            },
            "url": "{{baseUrl}}/api/v2/admin/users"
          }
        },
        {
          "name": "Get user by id",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v2/admin/users/{{userId}}"
          }
        },
        {
          "name": "Delete user",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "url": "{{baseUrl}}/api/v2/admin/users/{{userId}}"
          }
        },
        {
          "name": "Update role",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"ADMIN\"\n}"
            },
            "url": "{{baseUrl}}/api/v2/admin/users/{{userId}}/role"
          }
        }
      ]
    },
    {
      "name": "Admin - Categories",
      "item": [
        {
          "name": "Create category",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Histoire\"\n}"
            },
            "url": "{{baseUrl}}/api/v2/admin/categories"
          }
        },
        {
          "name": "Update category",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Géographie\"\n}"
            },
            "url": "{{baseUrl}}/api/v2/admin/categories/{{categoryId}}"
          }
        },
        {
          "name": "Delete category",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}"
              }
            ],
            "url": "{{baseUrl}}/api/v2/admin/categories/{{categoryId}}"
          }
        }
      ]
    }
  ]
}
